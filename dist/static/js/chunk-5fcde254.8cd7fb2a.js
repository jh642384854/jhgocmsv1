(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5fcde254"],{"66da":function(e,t,i){"use strict";i.d(t,"c",function(){return a}),i.d(t,"b",function(){return n}),i.d(t,"a",function(){return l}),i.d(t,"d",function(){return o});var r=i("b775");function a(e){return Object(r["a"])({url:"admin/categories/list",method:"get",params:e})}function n(e){return Object(r["a"])({url:"admin/categories/delete",method:"get",params:{id:e}})}function l(e){return Object(r["a"])({url:"admin/categories/create",method:"post",data:e})}function o(e){return Object(r["a"])({url:"admin/categories/update",method:"post",data:e})}},ad2a:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"filter-container"},[i("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.handleCreate()}}},[e._v("\n      创建\n    ")])],1),e._v(" "),i("vxe-table",{ref:"xTable",staticClass:"vxe-table-element",attrs:{data:e.list,stripe:"",size:"small","highlight-hover-row":"","highlight-current-row":"","edit-config":{trigger:"manual",mode:"row"},"tree-config":{children:"children",expandAll:!0}},on:{"update:data":function(t){e.list=t}}},[i("vxe-table-column",{attrs:{type:"index",width:"300",title:"序号","tree-node":""}}),e._v(" "),i("vxe-table-column",{attrs:{field:"id",width:"50",title:"ID"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"mid",width:"150",title:"栏目模型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("modelTypeFilter")(t.row.mid))+"\n      ")]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"name",width:"100",title:"中文名称"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"en_name",width:"100",title:"英文名称","show-overflow":""}}),e._v(" "),i("vxe-table-column",{attrs:{field:"sort",width:"50",title:"排序"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"created_at",width:"150",title:"创建时间"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"description",title:"描述","show-header-overflow":"","show-overflow":""}}),e._v(" "),i("vxe-table-column",{attrs:{title:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[i("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.handleCreate(r)}}},[e._v("添加子栏目")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleEdit(r.id,r)}}},[e._v("编辑")]),e._v(" "),2==r.mid?i("router-link",{staticClass:"el-button el-button el-button--info el-button--mini",attrs:{to:"/article/add?cid="+r.id}},[i("span",[e._v("添加文章")])]):1==r.mid?i("router-link",{staticClass:"el-button el-button el-button--mini",attrs:{to:"/article/pageedit/"+r.id}},[i("span",[e._v("修改内容")])]):e._e(),e._v(" "),"undefined"==typeof r.children||0==r.children.length?i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deleteRow(r)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),i("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{ref:"dataForm",attrs:{rules:e.rules,model:e.ruleForm,"label-position":"left","label-width":"100px"}},[i("el-form-item",{attrs:{label:"父栏目",prop:"pid"}},[i("treeselect",{attrs:{multiple:!1,options:e.categories,normalizer:e.normalizer},model:{value:e.ruleForm.pid,callback:function(t){e.$set(e.ruleForm,"pid",t)},expression:"ruleForm.pid"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"栏目模型",prop:"mid"}},[i("el-select",{attrs:{placeholder:"请选择栏目模型"},model:{value:e.ruleForm.mid,callback:function(t){e.$set(e.ruleForm,"mid",t)},expression:"ruleForm.mid"}},e._l(e.catModelOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"中文名称",prop:"name"}},[i("el-input",{attrs:{maxlength:"30","show-word-limit":e.showWordLimit},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"英文名称",prop:"en_name"}},[i("el-input",{attrs:{maxlength:"30","show-word-limit":e.showWordLimit},model:{value:e.ruleForm.en_name,callback:function(t){e.$set(e.ruleForm,"en_name",t)},expression:"ruleForm.en_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"排序",prop:"sort"}},[i("el-input-number",{attrs:{min:1,max:100},model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"栏目介绍",prop:"description"}},[i("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容",maxlength:"200","show-word-limit":e.showWordLimit},model:{value:e.ruleForm.description,callback:function(t){e.$set(e.ruleForm,"description",t)},expression:"ruleForm.description"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("\n        取消\n      ")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){"create"===e.dialogStatus?e.createData():e.updateData()}}},[e._v("\n        "+e._s(e.textMap[e.dialogStatus])+"\n      ")])],1)],1)],1)},a=[],n=(i("ac4d"),i("8a81"),i("ac6a"),i("7f7f"),i("66da")),l=i("c695"),o=i.n(l),s=i("7026"),d=i.n(s),c=(i("542c"),function(e,t,i){var r=/^[a-zA-Z0-9\s]{1,20}$/g;""===t?i(new Error("请输入英文名称")):r.test(t)?i():i(new Error("请输入正确的英文名称"))}),u={name:"categories",components:{Treeselect:d.a},filters:{modelTypeFilter:function(e){return 1==e?"单页模型":2==e?"文章模型":void 0}},beforeCreate:function(){this},data:function(){return{catModelOptions:[{name:"单页模型",value:1},{name:"文章模型",value:2}],showWordLimit:!0,categories:[],list:[],treeConfig:{children:"children"},total:0,normalizer:function(e){return{id:e.id,label:e.name,children:e.children}},listLoading:!0,modifyPass:0,adminRoles:[],dialogFormVisible:!1,dialogStatus:"",textMap:{update:"修改",create:"创建"},ruleForm:{id:"",pid:0,mid:"",created_at:"",en_name:"",name:"",description:"",sort:1,children:[]},rules:{pid:[{required:!0,message:"父栏目必须选择",trigger:"blur,change"}],mid:[{required:!0,message:"栏目模型必须选择",trigger:"blur,change"}],en_name:[{required:!0,message:"请输入英文名称",trigger:"blur"},{validator:c,trigger:"blur"}],name:[{required:!0,message:"栏目名称必须填写",trigger:"blur"}],sort:[{required:!0,message:"排序必须输入",trigger:"blur"}]}}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.listLoading=!0,Object(n["c"])().then(function(t){e.list=t.data.items,e.categories=JSON.parse(JSON.stringify(t.data.items)),e.categoriesAddRoot()})},categoriesAddRoot:function(){var e={id:0,name:"顶级栏目"};this.categories.unshift(e)},resetTemp:function(){this.ruleForm={id:"",pid:0,mid:"",created_at:"",en_name:"",name:"",description:"",sort:1,children:[]}},handleCreate:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.resetTemp(),null!=t&&(this.ruleForm.pid=t.id),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs["dataForm"].clearValidate()})},createData:function(){var e=this;this.$refs["dataForm"].validate(function(t){t&&Object(n["a"])(e.ruleForm).then(function(t){if(t.data.status==e.GLOBAL.SuccessText){if(e.ruleForm.id=t.data.last_id,e.ruleForm.created_at=t.data.created_at,0===e.ruleForm.pid)e.list.unshift(e.ruleForm);else{var i=e.$refs.xTable;i.createRow(e.ruleForm).then(function(t){var i=o.a.findTree(e.list,function(t){return t.id===e.ruleForm.pid},e.treeConfig);if(i){var r=!0,a=!1,n=void 0;try{for(var l,s=i.items[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var d=l.value;if(d.id==e.ruleForm.pid){var c=i.items.indexOf(d);"undefined"==typeof i.items[c].children&&(i.items[c].children=[]),i.items[c].children.unshift(e.ruleForm);break}}}catch(u){a=!0,n=u}finally{try{r||null==s.return||s.return()}finally{if(a)throw n}}}})}e.categories=JSON.parse(JSON.stringify(e.list)),e.categoriesAddRoot(),e.dialogFormVisible=!1,e.GLOBAL.msgNotify("success","成功",t.data.msg)}else e.GLOBAL.msgNotify("error","失败",t.data.msg)})})},handleEdit:function(e,t){var i=this;this.ruleForm=Object.assign({},t),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick(function(){i.$refs["dataForm"].clearValidate()})},updateData:function(){var e=this;this.$refs["dataForm"].validate(function(t){if(t){var i=Object.assign({},e.ruleForm);Object(n["d"])(i).then(function(t){if(t.data.status==e.GLOBAL.SuccessText){var r=o.a.findTree(e.list,function(t){return t.id===e.ruleForm.id},e.treeConfig);if(null==r.parent)e.list.forEach(function(e,t,r){e.id==i.id&&r.splice(t,1),e.id==i.pid&&r[t].children.unshift(i)});else if(i.pid!=r.parent.id)if(r.parent.children.forEach(function(e,t,r){e.id==i.id&&r.splice(t,1)}),0==i.pid)e.list.unshift(i);else{var a=o.a.findTree(e.list,function(e){return e.id===i.pid},e.treeConfig);null==a.parent?a.items.forEach(function(e,t,r){e.id==i.pid&&r[t].children.unshift(i)}):a.parent.children.forEach(function(e,t,r){e.id==i.pid&&r[t].children.unshift(i)})}else r.parent.children.forEach(function(e,t,r){e.id==i.id&&r.splice(t,1,i)});e.categories=JSON.parse(JSON.stringify(e.list)),e.categoriesAddRoot(),e.dialogFormVisible=!1,e.GLOBAL.msgNotify("success","成功",t.data.msg)}else e.GLOBAL.msgNotify("error","失败",t.data.msg)})}})},deleteRow:function(e){var t=this;this.$confirm("确定要删除该记录吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"删除",cancelButtonText:"放弃"}).then(function(){Object(n["b"])(e.id).then(function(i){if(i.data.status==t.GLOBAL.SuccessText){var r=o.a.findTree(t.list,function(t){return t.id===e.id},t.treeConfig);if(null==r.parent){var a=t.list.indexOf(e);t.list.splice(a,1)}else t.$refs.xTable.remove(e);t.GLOBAL.msgNotify("success","成功",i.data.msg)}else t.GLOBAL.msgNotify("error","失败",i.data.msg)})}).catch(function(e){t.$message({type:"info",message:"cancel"===e?"放弃操作并离开页面":"停留在当前页面"})})}}},m=u,f=i("2877"),p=Object(f["a"])(m,r,a,!1,null,null,null);t["default"]=p.exports}}]);